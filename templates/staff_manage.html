{% extends "base.html" %}

{% block title %}スタッフ管理{% endblock %}

{% block content %}
<h2>スタッフ管理</h2>

<!-- 編集ボタン -->
<button id="editButton" onclick="toggleEditMode()">編集</button>

<form id="staffForm" action="/staff/update_bulk" method="POST" style="display: none;">
    <table>
        <thead>
            <tr>
                <th>名前</th>
                <th>性別</th>
                <th>希望日数</th>
                <th>キッチンA</th>
                <th>キッチンB</th>
                <th>ドリンク</th>
                <th>ホール</th>
                <th>リーダーシップ</th>
            </tr>
        </thead>
        <tbody>
          {% for staff in staffs %}
              <tr id="staff_{{ staff.id }}">
                  <td><input type="text" name="staffs[{{ staff.id }}][name]" value="{{ staff.name }}" readonly></td>
                  <td><input type="text" name="staffs[{{ staff.id }}][gender]" value="{{ staff.gender }}" readonly></td>
                  <td><input type="number" name="staffs[{{ staff.id }}][desired_days]" value="{{ staff.desired_days }}" readonly></td>
                  <td><input type="number" name="staffs[{{ staff.id }}][kitchen_a]" value="{{ staff.kitchen_a }}" readonly></td>
                  <td><input type="number" name="staffs[{{ staff.id }}][kitchen_b]" value="{{ staff.kitchen_b }}" readonly></td>
                  <td><input type="number" name="staffs[{{ staff.id }}][drink]" value="{{ staff.drink }}" readonly></td>
                  <td><input type="number" name="staffs[{{ staff.id }}][hall]" value="{{ staff.hall }}" readonly></td>
                  <td><input type="number" name="staffs[{{ staff.id }}][leadership]" value="{{ staff.leadership }}" readonly></td>
                  <input type="hidden" name="staffs[{{ staff.id }}][id]" value="{{ staff.id }}">
              </tr>
          {% endfor %}
      </tbody>
    </table>
    <button type="submit">保存</button>
    <button type="button" onclick="cancelEdit()">キャンセル</button>
</form>

{% endblock %}

<script>
function toggleEditMode() {
    const form = document.getElementById('staffForm');
    const editButton = document.getElementById('editButton');
    const inputs = form.querySelectorAll('input');

    // 編集モードの切り替え
    if (form.style.display === 'none') {
        form.style.display = 'block';
        editButton.innerText = '終了';
        inputs.forEach(input => input.removeAttribute('readonly'));
    } else {
        form.style.display = 'none';
        editButton.innerText = '編集';
        inputs.forEach(input => input.setAttribute('readonly', true));
    }
}

function cancelEdit() {
    const form = document.getElementById('staffForm');
    const inputs = form.querySelectorAll('input');
    
    // 編集をキャンセルして元の状態に戻す
    inputs.forEach(input => {
        input.setAttribute('readonly', true);
        // フォームを非表示にして元に戻す
        form.style.display = 'none';
    });
    document.getElementById('editButton').innerText = '編集';
}
</script>
