{% extends "base.html" %}

{% block header_title %}スタッフ管理{% endblock %}

{% block content %}
<h2>{{ store_name }}</h2>

<form id="staffForm" action="/staff/update_bulk" method="POST">  

{% if staffs %}
<table class="staff-table">
    <thead>
        <tr>
            <th>名前</th>
            <th>性別</th>
            <th>キッチンA</th>
            <th>キッチンB</th>
            <th>ホール</th>
            <th>リーダー<br>シップ</th>
            <th>ログイン<br>コード</th>
            <th>パスワード</th>
            <th>勤務形態</th>
            <th>削除</th>
        </tr>
    </thead>
    <tbody>
    {% for staff in staffs %}
        <tr id="staff_{{ staff.id }}">
            <td><input type="text" name="staffs[{{ staff.id }}][name]" value="{{ staff.name if staff.name is not none else '未設定' }}" required></td>
            <td><input type="text" name="staffs[{{ staff.id }}][gender]" value="{{ staff.gender if staff.gender is not none else '未設定' }}" required></td>
            <td><input type="text" name="staffs[{{ staff.id }}][kitchen_a]" value="{{ staff.kitchen_a if staff.kitchen_a is not none else '未設定' }}" required></td>
            <td><input type="text" name="staffs[{{ staff.id }}][kitchen_b]" value="{{ staff.kitchen_b if staff.kitchen_b is not none else '未設定' }}" required></td>
            <td><input type="number" name="staffs[{{ staff.id }}][hall]" value="{{ staff.hall if staff.hall is not none else '未設定' }}" required></td>
            <td><input type="number" name="staffs[{{ staff.id }}][leadership]" value="{{ staff.leadership if staff.leadership is not none else '未設定' }}" required></td>
            <td><input type="text" name="staffs[{{ staff.id }}][login_code]" value="{{ staff.login_code if staff.login_code is not none else '未設定' }}" required></td>
            <td><input type="text" name="staffs[{{ staff.id }}][password]" value="{{ staff.password if staff.password is not none else '未設定' }}" required></td>
            <td><input type="text" name="staffs[{{ staff.id }}][employment_type]" value="{{ staff.employment_type if staff.employment_type is not none else '未設定' }}" required></td>
            <!-- 削除ボタンは常に表示 -->
            <td><button type="button" class="deleteButton" data-staff-id="{{ staff.id }}" data-staff-name="{{ staff.name }}">削除</button></td>
            <input type="hidden" name="staffs[{{ staff.id }}][id]" value="{{ staff.id }}">
        </tr>
    {% endfor %}
    </tbody>
</table>
{% else %}
<p>スタッフ情報がありません。</p>
{% endif %}

<!-- 保存ボタンとキャンセルボタン -->
<button type="submit" id="saveButton">保存</button>
<button type="button" id="cancelButton" onclick="cancelChanges()">キャンセル</button>
</form>

{% endblock %}

<script>
    // 保存ボタンの確認ダイアログ
    document.getElementById('saveButton').addEventListener('click', function(event) {
        if (!confirm('変更を保存しますか？')) {
            event.preventDefault(); // 保存をキャンセル
        }
    });

    // キャンセルボタンの確認ダイアログ
    function cancelChanges() {
        if (confirm('変更を破棄しますか？')) {
            // フォームの内容を元に戻す
            document.getElementById('staffForm').reset();
        }
    }

    // 削除確認ダイアログ
    document.addEventListener('DOMContentLoaded', function() {
        const deleteButtons = document.querySelectorAll('.deleteButton');
        
        deleteButtons.forEach(button => {
            button.addEventListener('click', function() {
                const staffId = button.dataset.staffId;
                const staffName = button.dataset.staffName;
                if (confirm(staffName + 'の登録情報を削除しますか？')) {
                    window.location.href = '/staff/delete/' + staffId;  // 削除処理用URLにリダイレクト
                }
            });
        });
    });
</script>
