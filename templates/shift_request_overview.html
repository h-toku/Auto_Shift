{% extends "base.html" %}

{% block header_title %}シフト希望確認{% endblock %}

{% block content %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>シフト希望確認</title>
</head>
<body>
    <h1>シフト希望確認</h1>

    

    <div class="select-year-month">
    <form method="get" action="/shift_request/overview">
        <select name="year">
            {% for y in years %}
            <option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>{{ y }}</option>
            {% endfor %}
        </select>年
        <select name="month">
            {% for m in months %}
            <option value="{{ m }}" {% if m == selected_month %}selected{% endif %}>{{ m }}</option>
            {% endfor %}
        </select>月
        <button type="submit">表示</button>
        </form>
    </div>

{% set mid = (dates | length) // 2 + (dates | length) % 2 %}
{% set first_half = dates[:mid] %}
{% set second_half = dates[mid:] %}

<form method="post" action="/shift_request/overview">
    <table class="calendar-table">
      <tbody>
        <!-- 前半：日付 -->
        <tr>
          <td>日付</td>
          {% for date in first_half %}
          <td class="{{ 'today' if date.is_today else '' }} {{ 'saturday' if date.is_saturday else '' }} {{ 'sunday' if date.is_sunday else '' }}">
            {{ date.day }}<br>{{ date.weekday }}
          </td>
          {% endfor %}
        </tr>
        <!-- 前半：希望 -->
        <tr>
          <td>希望</td>
          {% for date in first_half %}
          <td>
            {% if date.requests %}
                {% for req in date.requests %}
                <span class="small-text">{{ req.staff_name }}：{{ req.status }}</span><br>
            {% endfor %}
            {% else %}
                -
            {% endif %}
          </td>
          {% endfor %}
        </tr>
      
        <!-- 後半：日付 -->
        <tr>
          <td>日付</td>
          {% for date in second_half %}
          <td class="{{ 'today' if date.is_today else '' }} {{ 'saturday' if date.is_saturday else '' }} {{ 'sunday' if date.is_sunday else '' }}">
            {{ date.day }}<br>{{ date.weekday }}
          </td>
          {% endfor %}
        </tr>
        <!-- 後半：希望 -->
        <tr>
          <td>希望</td>
          {% for date in second_half %}
          <td>
            {% if date.requests %}
                {% for req in date.requests %}
                <span class="small-text">{{ req.staff_name }}：{{ req.status }}</span><br>
            {% endfor %}
            {% else %}
                -
            {% endif %}
          </td>
          {% endfor %}
        </tr>
      </tbody>      
    </table>
{% endblock %}