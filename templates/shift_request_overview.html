{% extends "base.html" %}

{% block header_title %}シフト希望確認{% endblock %}

{% block content %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>シフト希望確認</title>
</head>
<body>
    <h1>シフト希望確認</h1>

    <div class="select-year-month">
    <form method="get" action="/shift_request/overview">
        <select name="year">
            {% for y in years %}
            <option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>{{ y }}</option>
            {% endfor %}
        </select>年
        <select name="month">
            {% for m in months %}
            <option value="{{ m }}" {% if m == selected_month %}selected{% endif %}>{{ m }}</option>
            {% endfor %}
        </select>月
        <button type="submit">表示</button>
        </form>
    </div>

{% set mid = (dates | length) // 2 + (dates | length) % 2 %}
{% set first_half = dates[:mid] %}
{% set second_half = dates[mid:] %}

<div class="scroll-container">
  <!-- 固定列（日付） -->
  <table class="calendar-table fixed-column">
    <thead>
      <tr><th>日付</th></tr>
    </thead>
    <tbody>
      {% for date in dates %}
      <tr>
        <td class="{{ 'today' if date.is_today else '' }} {{ 'saturday' if date.is_saturday else '' }} {{ 'sunday' if date.is_sunday else '' }}">
          {{ date.day }}<br>{{ date.weekday }}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- スクロール部分（スタッフ × シフト） -->
  <div class="scrollable-table-container">
    <table class="calendar-table">
      <thead>
        <tr>
          {% for staff in staffs %}
          <th>{{ staff.name }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for date in dates %}
        <tr>
          {% for staff in staffs %}
          <td>
            {% set req = (date.requests | selectattr("staff_name", "equalto", staff.name) | list) %}
            {% if req %}
              <span class="small-text">{{ req[0].status }}</span>
            {% else %}
              -
            {% endif %}
          </td>
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% endblock %}